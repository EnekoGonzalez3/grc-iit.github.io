import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

### Load Basic Packages

```bash
spack load iowarp
```

Make sure to understand your environment. If you get errors
like `package X was not found`, it is most likely you forgot
to do either `spack load X` or `module load X`.

### Configure SCSPKG

Read [this](https://grc.iit.edu/docs/jarvis/scspkg/index) guide to configure scspkg.


### Install Packages Manually with WrpGit

wrpgit is a command line utility built in Python that is used for manually installing packages.
Manual installation is necessary for when developing certain packages.

wrpgit should be executed directly from the iowarp-install directly. Do not install this file
to another directory using something like pip.

#### Dependencies

```bash
cd ${IOWARP}/iowarp-install
pip install -r requirements.txt
chmod +x wrpgit
```

### Install GitHub CLI

<Tabs>
    <TabItem value="spack" label="Spack" default>
Install using Spack:
```bash
spack install gh
```
    </TabItem>
    <TabItem value="ubuntu" label="Ubuntu">
Install using apt on Ubuntu:
```bash
type -p curl >/dev/null || (sudo apt update && sudo apt install curl -y)
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
&& sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
&& echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
&& sudo apt update \
&& sudo apt install gh -y
```
    </TabItem>
</Tabs>

#### Initialize

The following initializes wrpgit YAML configuration:
```bash
./wrpgit init
```

It will be stored in ``$IOWARP/iowarp-install/wrpgit.yaml``.
This file looks roughly as follows:
```yaml
username: iowarp 
protocol: ssh
modules:
- name: cte-hermes-shm
  build: True
  fork: False
  type: cmake
  preset: debug
- name: iowarp-runtime
  build: True
  fork: False
  type: cmake
  preset: debug
  depends_on: cte-hermes-shm
```

* ``username``: your github username
* ``protocol``: the protocol to use for clone. Typically ssh.
* ``modules``: the set of manual builds to create. You can add or remove packages from this list.

#### Fork

If you are working on iowarp, but are not considered full-time staff, we will 
have you fork our code instead of being a branch maintainer. 

You will should be told the specific repos you are expected to work on:
Make the following changes to the wrpgit.yaml:

```yaml
username: [MY GITHUB USERNAME]
protocol: ssh
modules:
- name: cte-hermes-shm
  build: True
  fork: True  # MAKE THIS TRUE
  type: cmake
  preset: debug
- name: iowarp-runtime
  build: True
  fork: True  # MAKE THIS TRUE
  type: cmake
  preset: debug
  depends_on: cte-hermes-shm
```

And then run:
```bash
./wrpgit fork
```

Any package with ``fork: True`` will be forked from iowarp into the github account
[MY GITHUB USERNAME].

#### Clone

```bash
./wrpgit clone
```

This will clone all packages in the modules directory. ``name: iowarp-runtime`` is assumed
to be the real name of the github repo.

#### Setup

```bash
./wrpgit setup
```

This will construct modulefiles and environments for each of the packages.
You should rerun this if you spack packages or any dependencies of iowarp.

#### Build

```bash
./wrpgit build
````

This will build and install all repos with ``build: True``. 


#### Clean

```bash
./wrpgit clean
```

This will destroy all build directories.
You should rerun this if you spack packages or any dependencies of iowarp.

### For Pull Requests

You may find the github [command line](https://cli.github.com/) useful for making PRs.

```bash
gh auth login
gh repo set-default
gh pr create --title "Your pull request title" --body "Your pull request description"
``` 

